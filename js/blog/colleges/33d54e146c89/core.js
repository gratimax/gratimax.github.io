goog.provide("blog.colleges.core"),goog.require("cljs.core"),goog.require("blog.colleges.list"),goog.require("blog.d3"),cljs.core.enable_console_print_BANG_(),blog.colleges.core.mk_date=function(l){var e=l,c=cljs.core.nth.cljs$core$IFn$_invoke$arity$3(e,0,null),o=cljs.core.nth.cljs$core$IFn$_invoke$arity$3(e,1,null),s=cljs.core.nth.cljs$core$IFn$_invoke$arity$3(e,2,null);return new Date(2e3+s,c-1,o)},blog.colleges.core.mk_date_vector=function(l){return new cljs.core.PersistentVector(null,3,5,cljs.core.PersistentVector.EMPTY_NODE,[l.getMonth()+1,l.getDate(),l.getFullYear()-2e3],null)},blog.colleges.core.add_days=function(l,e){var c=new Date(l);return c.setDate(l.getDate()+e),c},blog.colleges.core.colleges_dates=cljs.core.map.cljs$core$IFn$_invoke$arity$2(cljs.core.comp.cljs$core$IFn$_invoke$arity$2(blog.colleges.core.mk_date,cljs.core.cst$kw$date),blog.colleges.list.colleges_list),blog.colleges.core.full_date_extent=function(){var l=blog.d3.extent(blog.colleges.core.colleges_dates),e=cljs.core.nth.cljs$core$IFn$_invoke$arity$3(l,0,null),c=cljs.core.nth.cljs$core$IFn$_invoke$arity$3(l,1,null);return new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[blog.colleges.core.add_days(e,-3),blog.colleges.core.add_days(c,3)],null)}(),blog.colleges.core.first_date=cljs.core.first(blog.colleges.core.full_date_extent),blog.colleges.core.last_date=cljs.core.second(blog.colleges.core.full_date_extent),blog.colleges.core.last_or_current_date=function(){var l=new Date,e=blog.colleges.core.last_date;return e>l?l:e}(),blog.colleges.core.colleges_graph=function(){var l=cljs.core.take_while.cljs$core$IFn$_invoke$arity$2(function(l){return cljs.core.not(cljs.core.cst$kw$upcoming.cljs$core$IFn$_invoke$arity$1(l))},cljs.core.next(cljs.core.reductions.cljs$core$IFn$_invoke$arity$3(function(l,e){return cljs.core.update.cljs$core$IFn$_invoke$arity$3(cljs.core.assoc.cljs$core$IFn$_invoke$arity$3(l,cljs.core.cst$kw$date,blog.colleges.core.mk_date(cljs.core.cst$kw$date.cljs$core$IFn$_invoke$arity$1(e))),cljs.core.cst$kw$status.cljs$core$IFn$_invoke$arity$1(e),cljs.core.inc)},new cljs.core.PersistentArrayMap(null,3,[cljs.core.cst$kw$accept,0,cljs.core.cst$kw$waitlist,0,cljs.core.cst$kw$reject,0],null),blog.colleges.list.colleges_list))),e=cljs.core.merge.cljs$core$IFn$_invoke$arity$variadic(cljs.core.array_seq([cljs.core.last(l),new cljs.core.PersistentArrayMap(null,2,[cljs.core.cst$kw$date,blog.colleges.core.last_or_current_date,cljs.core.cst$kw$cur_DASH_day,!0],null)],0));return cljs.core.concat.cljs$core$IFn$_invoke$arity$2(l,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[e],null))}(),blog.colleges.core.viz=blog.d3.select.cljs$core$IFn$_invoke$arity$1("#viz"),blog.colleges.core.viz_node=blog.d3.node(blog.colleges.core.viz),blog.colleges.core.d3_window=blog.d3.select.cljs$core$IFn$_invoke$arity$1(window),blog.colleges.core.viz_width=blog.d3.attr(blog.colleges.core.viz,cljs.core.cst$kw$width),blog.colleges.core.viz_height=blog.d3.attr(blog.colleges.core.viz,cljs.core.cst$kw$height),blog.colleges.core.in_bounds=function(l,e){return l>0&&l<blog.colleges.core.viz_width&&e>0&&e<blog.colleges.core.viz_height},blog.colleges.core.time_format=blog.d3.time_format("%d %b %y"),blog.colleges.core.x_scale=blog.d3.time_scale.cljs$core$IFn$_invoke$arity$variadic(cljs.core.array_seq([cljs.core.cst$kw$domain,blog.colleges.core.full_date_extent,cljs.core.cst$kw$range,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[0,blog.colleges.core.viz_width],null)],0)),blog.colleges.core.y_scale_above=blog.d3.linear_scale.cljs$core$IFn$_invoke$arity$variadic(cljs.core.array_seq([cljs.core.cst$kw$domain,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[0,10],null),cljs.core.cst$kw$range,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[blog.colleges.core.viz_height/2,0],null)],0)),blog.colleges.core.y_scale_below=blog.d3.linear_scale.cljs$core$IFn$_invoke$arity$variadic(cljs.core.array_seq([cljs.core.cst$kw$domain,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[0,10],null),cljs.core.cst$kw$range,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[blog.colleges.core.viz_height/2,blog.colleges.core.viz_height],null)],0)),blog.colleges.core.make_axes=function(){var l=blog.d3.axis.cljs$core$IFn$_invoke$arity$variadic(cljs.core.array_seq([cljs.core.cst$kw$scale,blog.colleges.core.x_scale,cljs.core.cst$kw$ticks,0,cljs.core.cst$kw$outer_DASH_tick_DASH_size,0],0));return blog.d3.call(blog.d3.attrs.cljs$core$IFn$_invoke$arity$variadic(blog.d3.append(blog.colleges.core.viz,cljs.core.cst$kw$g),cljs.core.array_seq([cljs.core.cst$kw$class,"x axis",cljs.core.cst$kw$transform,blog.d3.translate(0,blog.colleges.core.viz_height/2)],0)),l)},blog.colleges.core.upcoming_dates=cljs.core.map.cljs$core$IFn$_invoke$arity$2(blog.colleges.core.mk_date,cljs.core.distinct.cljs$core$IFn$_invoke$arity$1(cljs.core.map.cljs$core$IFn$_invoke$arity$2(cljs.core.cst$kw$date,cljs.core.filter.cljs$core$IFn$_invoke$arity$2(function(l){return cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2(cljs.core.cst$kw$status.cljs$core$IFn$_invoke$arity$1(l),cljs.core.cst$kw$upcoming)},blog.colleges.list.colleges_list)))),blog.colleges.core.make_upcoming_rect=function(){var l=cljs.core.last(blog.colleges.core.colleges_graph),e=function(){var e=cljs.core.cst$kw$date.cljs$core$IFn$_invoke$arity$1(l);return blog.colleges.core.x_scale.cljs$core$IFn$_invoke$arity$1?blog.colleges.core.x_scale.cljs$core$IFn$_invoke$arity$1(e):blog.colleges.core.x_scale.call(null,e)}(),c=function(){var l=cljs.core.last(blog.colleges.core.colleges_dates);return blog.colleges.core.x_scale.cljs$core$IFn$_invoke$arity$1?blog.colleges.core.x_scale.cljs$core$IFn$_invoke$arity$1(l):blog.colleges.core.x_scale.call(null,l)}(),o=c-e,s=function(){var e=cljs.core.cst$kw$accept.cljs$core$IFn$_invoke$arity$1(l);return blog.colleges.core.y_scale_above.cljs$core$IFn$_invoke$arity$1?blog.colleges.core.y_scale_above.cljs$core$IFn$_invoke$arity$1(e):blog.colleges.core.y_scale_above.call(null,e)}(),r=function(){var e=cljs.core.cst$kw$waitlist.cljs$core$IFn$_invoke$arity$1(l)+cljs.core.cst$kw$reject.cljs$core$IFn$_invoke$arity$1(l);return blog.colleges.core.y_scale_below.cljs$core$IFn$_invoke$arity$1?blog.colleges.core.y_scale_below.cljs$core$IFn$_invoke$arity$1(e):blog.colleges.core.y_scale_below.call(null,e)}(),n=r-s;blog.d3.attrs.cljs$core$IFn$_invoke$arity$variadic(blog.d3.append(blog.colleges.core.viz,cljs.core.cst$kw$rect),cljs.core.array_seq([cljs.core.cst$kw$class,"area upcoming",cljs.core.cst$kw$x,e,cljs.core.cst$kw$y,s,cljs.core.cst$kw$width,o,cljs.core.cst$kw$height,n],0));for(var t=cljs.core.seq(blog.colleges.core.upcoming_dates),$=null,a=0,j=0;;)if(a>j){var i=$.cljs$core$IIndexed$_nth$arity$2(null,j),u=blog.colleges.core.x_scale.cljs$core$IFn$_invoke$arity$1?blog.colleges.core.x_scale.cljs$core$IFn$_invoke$arity$1(i):blog.colleges.core.x_scale.call(null,i);blog.d3.attrs.cljs$core$IFn$_invoke$arity$variadic(blog.d3.append(blog.colleges.core.viz,cljs.core.cst$kw$line),cljs.core.array_seq([cljs.core.cst$kw$class,"college-upcoming-line",cljs.core.cst$kw$x1,u,cljs.core.cst$kw$y1,s,cljs.core.cst$kw$x2,u,cljs.core.cst$kw$y2,r],0));var y=t,_=$,g=a,w=j+1;t=y,$=_,a=g,j=w}else{var b=cljs.core.seq(t);if(!b)return null;var m=b;if(cljs.core.chunked_seq_QMARK_(m)){var d=cljs.core.chunk_first(m),k=cljs.core.chunk_rest(m),v=d,S=cljs.core.count(d),h=0;t=k,$=v,a=S,j=h;continue}var i=cljs.core.first(m),f=blog.colleges.core.x_scale.cljs$core$IFn$_invoke$arity$1?blog.colleges.core.x_scale.cljs$core$IFn$_invoke$arity$1(i):blog.colleges.core.x_scale.call(null,i);blog.d3.attrs.cljs$core$IFn$_invoke$arity$variadic(blog.d3.append(blog.colleges.core.viz,cljs.core.cst$kw$line),cljs.core.array_seq([cljs.core.cst$kw$class,"college-upcoming-line",cljs.core.cst$kw$x1,f,cljs.core.cst$kw$y1,s,cljs.core.cst$kw$x2,f,cljs.core.cst$kw$y2,r],0));var p=cljs.core.next(m),I=null,F=0,x=0;t=p,$=I,a=F,j=x}},blog.colleges.core.make_areas=function(){var l=blog.d3.area.cljs$core$IFn$_invoke$arity$variadic(cljs.core.array_seq([cljs.core.cst$kw$x,function(l){var e=cljs.core.cst$kw$date.cljs$core$IFn$_invoke$arity$1(l);return blog.colleges.core.x_scale.cljs$core$IFn$_invoke$arity$1?blog.colleges.core.x_scale.cljs$core$IFn$_invoke$arity$1(e):blog.colleges.core.x_scale.call(null,e)},cljs.core.cst$kw$y0,cljs.core.constantly(blog.colleges.core.y_scale_above.cljs$core$IFn$_invoke$arity$1?blog.colleges.core.y_scale_above.cljs$core$IFn$_invoke$arity$1(0):blog.colleges.core.y_scale_above.call(null,0)),cljs.core.cst$kw$y1,function(l){var e=cljs.core.cst$kw$accept.cljs$core$IFn$_invoke$arity$1(l);return blog.colleges.core.y_scale_above.cljs$core$IFn$_invoke$arity$1?blog.colleges.core.y_scale_above.cljs$core$IFn$_invoke$arity$1(e):blog.colleges.core.y_scale_above.call(null,e)},cljs.core.cst$kw$interpolate,cljs.core.cst$kw$step_DASH_after],0)),e=blog.d3.area.cljs$core$IFn$_invoke$arity$variadic(cljs.core.array_seq([cljs.core.cst$kw$x,function(l){return function(l){var e=cljs.core.cst$kw$date.cljs$core$IFn$_invoke$arity$1(l);return blog.colleges.core.x_scale.cljs$core$IFn$_invoke$arity$1?blog.colleges.core.x_scale.cljs$core$IFn$_invoke$arity$1(e):blog.colleges.core.x_scale.call(null,e)}}(l),cljs.core.cst$kw$y0,function(l){return function(l){var e=cljs.core.cst$kw$waitlist.cljs$core$IFn$_invoke$arity$1(l);return blog.colleges.core.y_scale_below.cljs$core$IFn$_invoke$arity$1?blog.colleges.core.y_scale_below.cljs$core$IFn$_invoke$arity$1(e):blog.colleges.core.y_scale_below.call(null,e)}}(l),cljs.core.cst$kw$y1,function(l){return function(l){var e=cljs.core.cst$kw$waitlist.cljs$core$IFn$_invoke$arity$1(l)+cljs.core.cst$kw$reject.cljs$core$IFn$_invoke$arity$1(l);return blog.colleges.core.y_scale_below.cljs$core$IFn$_invoke$arity$1?blog.colleges.core.y_scale_below.cljs$core$IFn$_invoke$arity$1(e):blog.colleges.core.y_scale_below.call(null,e)}}(l),cljs.core.cst$kw$interpolate,cljs.core.cst$kw$step_DASH_after],0)),c=blog.d3.area.cljs$core$IFn$_invoke$arity$variadic(cljs.core.array_seq([cljs.core.cst$kw$x,function(l,e){return function(l){var e=cljs.core.cst$kw$date.cljs$core$IFn$_invoke$arity$1(l);return blog.colleges.core.x_scale.cljs$core$IFn$_invoke$arity$1?blog.colleges.core.x_scale.cljs$core$IFn$_invoke$arity$1(e):blog.colleges.core.x_scale.call(null,e)}}(l,e),cljs.core.cst$kw$y0,cljs.core.constantly(blog.colleges.core.y_scale_below.cljs$core$IFn$_invoke$arity$1?blog.colleges.core.y_scale_below.cljs$core$IFn$_invoke$arity$1(0):blog.colleges.core.y_scale_below.call(null,0)),cljs.core.cst$kw$y1,function(l,e){return function(l){var e=cljs.core.cst$kw$waitlist.cljs$core$IFn$_invoke$arity$1(l);return blog.colleges.core.y_scale_below.cljs$core$IFn$_invoke$arity$1?blog.colleges.core.y_scale_below.cljs$core$IFn$_invoke$arity$1(e):blog.colleges.core.y_scale_below.call(null,e)}}(l,e),cljs.core.cst$kw$interpolate,cljs.core.cst$kw$step_DASH_after],0));return blog.d3.attrs.cljs$core$IFn$_invoke$arity$variadic(blog.d3.datum(blog.d3.append(blog.colleges.core.viz,cljs.core.cst$kw$path),blog.colleges.core.colleges_graph),cljs.core.array_seq([cljs.core.cst$kw$class,"area accept",cljs.core.cst$kw$d,l],0)),blog.d3.attrs.cljs$core$IFn$_invoke$arity$variadic(blog.d3.datum(blog.d3.append(blog.colleges.core.viz,cljs.core.cst$kw$path),blog.colleges.core.colleges_graph),cljs.core.array_seq([cljs.core.cst$kw$class,"area reject",cljs.core.cst$kw$d,e],0)),blog.d3.attrs.cljs$core$IFn$_invoke$arity$variadic(blog.d3.datum(blog.d3.append(blog.colleges.core.viz,cljs.core.cst$kw$path),blog.colleges.core.colleges_graph),cljs.core.array_seq([cljs.core.cst$kw$class,"area waitlist",cljs.core.cst$kw$d,c],0)),blog.colleges.core.make_upcoming_rect()},blog.colleges.core.make_current_day=function(){var l=blog.colleges.core.x_scale.cljs$core$IFn$_invoke$arity$1?blog.colleges.core.x_scale.cljs$core$IFn$_invoke$arity$1(blog.colleges.core.last_or_current_date):blog.colleges.core.x_scale.call(null,blog.colleges.core.last_or_current_date);return blog.d3.attrs.cljs$core$IFn$_invoke$arity$variadic(blog.d3.append(blog.colleges.core.viz,cljs.core.cst$kw$line),cljs.core.array_seq([cljs.core.cst$kw$class,"current-day",cljs.core.cst$kw$stroke_DASH_dasharray,"5, 5",cljs.core.cst$kw$x1,l,cljs.core.cst$kw$y1,0,cljs.core.cst$kw$x2,l,cljs.core.cst$kw$y2,blog.colleges.core.viz_height],0))},blog.colleges.core.hover_line=cljs.core.atom.cljs$core$IFn$_invoke$arity$1?cljs.core.atom.cljs$core$IFn$_invoke$arity$1(null):cljs.core.atom.call(null,null),blog.colleges.core.add_to_hover_line=function(l,e){return blog.d3.attrs.cljs$core$IFn$_invoke$arity$variadic(blog.d3.append(l,cljs.core.cst$kw$line),cljs.core.array_seq([cljs.core.cst$kw$x1,0,cljs.core.cst$kw$x2,0,cljs.core.cst$kw$y1,0,cljs.core.cst$kw$y2,blog.colleges.core.viz_height],0)),blog.d3.attrs.cljs$core$IFn$_invoke$arity$variadic(blog.d3.text(blog.d3.append(l,cljs.core.cst$kw$text),blog.colleges.core.time_format.cljs$core$IFn$_invoke$arity$1?blog.colleges.core.time_format.cljs$core$IFn$_invoke$arity$1(e):blog.colleges.core.time_format.call(null,e)),cljs.core.array_seq([cljs.core.cst$kw$y,20],0)),l},blog.colleges.core.human_status=new cljs.core.PersistentArrayMap(null,4,[cljs.core.cst$kw$accept,"Accepted!",cljs.core.cst$kw$reject,"Rejected",cljs.core.cst$kw$waitlist,"Waitlisted",cljs.core.cst$kw$upcoming,"Upcoming"],null),blog.colleges.core.set_college_result=function(l){return blog.d3.text(blog.d3.attrs.cljs$core$IFn$_invoke$arity$variadic(l,cljs.core.array_seq([cljs.core.cst$kw$class,function(l){return[cljs.core.str("college-result "),cljs.core.str(cljs.core.name(cljs.core.cst$kw$status.cljs$core$IFn$_invoke$arity$1(l)))].join("")},cljs.core.cst$kw$y,function(l,e){return 40+20*e}],0)),function(l){return[cljs.core.str(cljs.core.cst$kw$name.cljs$core$IFn$_invoke$arity$1(l)),cljs.core.str(" ("),cljs.core.str(function(){var e=cljs.core.cst$kw$status.cljs$core$IFn$_invoke$arity$1(l);return blog.colleges.core.human_status.cljs$core$IFn$_invoke$arity$1?blog.colleges.core.human_status.cljs$core$IFn$_invoke$arity$1(e):blog.colleges.core.human_status.call(null,e)}()),cljs.core.str(")")].join("")})},blog.colleges.core.results_by_date=cljs.core.group_by(cljs.core.cst$kw$date,blog.colleges.list.colleges_list),blog.colleges.core.set_hover_line_colleges=function(l,e){var c=function(){var l=function(){var l=blog.colleges.core.mk_date_vector(e);return blog.colleges.core.results_by_date.cljs$core$IFn$_invoke$arity$1?blog.colleges.core.results_by_date.cljs$core$IFn$_invoke$arity$1(l):blog.colleges.core.results_by_date.call(null,l)}();return cljs.core.truth_(l)?l:cljs.core.PersistentVector.EMPTY}(),o=blog.d3.data(blog.d3.selectAll.cljs$core$IFn$_invoke$arity$2(l,"text.college-result"),c);return blog.colleges.core.set_college_result(o),blog.d3.remove(blog.d3.exit(o)),blog.colleges.core.set_college_result(blog.d3.append(blog.d3.enter(o),cljs.core.cst$kw$text))},blog.colleges.core.get_hover_date=function(l){var e=blog.d3.invert(blog.colleges.core.x_scale,l);return cljs.core.last(cljs.core.take_while.cljs$core$IFn$_invoke$arity$2(function(l){return function(e){return l>=e}}(e),blog.colleges.core.colleges_dates))},blog.colleges.core.delete_hover=function(){var l=cljs.core.deref.cljs$core$IFn$_invoke$arity$1?cljs.core.deref.cljs$core$IFn$_invoke$arity$1(blog.colleges.core.hover_line):cljs.core.deref.call(null,blog.colleges.core.hover_line);if(cljs.core.truth_(l)){var e=l;return blog.d3.remove(e),cljs.core.reset_BANG_.cljs$core$IFn$_invoke$arity$2?cljs.core.reset_BANG_.cljs$core$IFn$_invoke$arity$2(blog.colleges.core.hover_line,null):cljs.core.reset_BANG_.call(null,blog.colleges.core.hover_line,null)}return null},blog.colleges.core.make_hover=function(l){var e=blog.colleges.core.x_scale.cljs$core$IFn$_invoke$arity$1?blog.colleges.core.x_scale.cljs$core$IFn$_invoke$arity$1(l):blog.colleges.core.x_scale.call(null,l),c=e<blog.colleges.core.viz_width/2,o=cljs.core.deref.cljs$core$IFn$_invoke$arity$1?cljs.core.deref.cljs$core$IFn$_invoke$arity$1(blog.colleges.core.hover_line):cljs.core.deref.call(null,blog.colleges.core.hover_line),s=function(){var e=o;return cljs.core.truth_(e)?e:blog.colleges.core.add_to_hover_line(blog.d3.append(blog.colleges.core.viz,cljs.core.cst$kw$g),l)}();return blog.d3.text(blog.d3.select.cljs$core$IFn$_invoke$arity$2(blog.d3.attrs.cljs$core$IFn$_invoke$arity$variadic(blog.d3.transition.cljs$core$IFn$_invoke$arity$variadic(s,cljs.core.array_seq([cljs.core.cst$kw$duration,500,cljs.core.cst$kw$ease,cljs.core.cst$kw$elastic],0)),cljs.core.array_seq([cljs.core.cst$kw$transform,blog.d3.translate(e,0),cljs.core.cst$kw$class,[cljs.core.str("hover"),cljs.core.str(c?" anchor-start":null)].join("")],0)),"text"),blog.colleges.core.time_format.cljs$core$IFn$_invoke$arity$1?blog.colleges.core.time_format.cljs$core$IFn$_invoke$arity$1(l):blog.colleges.core.time_format.call(null,l)),blog.colleges.core.set_hover_line_colleges(s,l),blog.d3.attrs.cljs$core$IFn$_invoke$arity$variadic(blog.d3.selectAll.cljs$core$IFn$_invoke$arity$2(s,"text"),cljs.core.array_seq([cljs.core.cst$kw$x,c?5:-5],0)),cljs.core.reset_BANG_.cljs$core$IFn$_invoke$arity$2?cljs.core.reset_BANG_.cljs$core$IFn$_invoke$arity$2(blog.colleges.core.hover_line,s):cljs.core.reset_BANG_.call(null,blog.colleges.core.hover_line,s)},blog.colleges.core.listen_to_mouse=function(){return blog.d3.on(blog.d3.window,cljs.core.cst$kw$mousemove,function(){var l=blog.d3.mouse(blog.colleges.core.viz_node),e=cljs.core.nth.cljs$core$IFn$_invoke$arity$3(l,0,null),c=cljs.core.nth.cljs$core$IFn$_invoke$arity$3(l,1,null);if(cljs.core.truth_(blog.colleges.core.in_bounds(e,c))){var o=blog.colleges.core.get_hover_date(e);if(cljs.core.truth_(o)){var s=o;return blog.colleges.core.make_hover(s)}return blog.colleges.core.delete_hover()}return blog.colleges.core.delete_hover()})},blog.colleges.core.make_areas(),blog.colleges.core.make_axes(),blog.colleges.core.make_current_day(),blog.colleges.core.listen_to_mouse();